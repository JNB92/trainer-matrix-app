<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Trainer & Assessor Matrix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" xintegrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoVBL5gI9kLmbG0CbnwFDEr4X1HarA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }

        details > summary {
            list-style: none;
        }
        details > summary::-webkit-details-marker {
            display: none;
        }
        details[open] summary .arrow {
            transform: rotate(180deg);
        }
        .arrow {
            transition: transform 0.2s;
        }
    </style>
    
    
    <!-- Google Fonts Import -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Custom Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'bca-red': '#d51f2e',
                        'bca-gold': '#c39137',
                        'bca-beige': '#eee6d4',
                        'bca-soft-white': '#f4f0ec',
                    },
                    fontFamily: {
                        'spartan': ['"League Spartan"', 'sans-serif'],
                        'roboto': ['"Roboto"', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
</head>
<body class="bg-bca-soft-white text-stone-800 font-roboto">

<!-- Header & Navigation -->
<header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
            <div class="flex-shrink-0">
                <h1 class="text-xl font-bold text-bca-gold font-spartan">Barrington College Australia</h1>
                <p class="text-sm text-stone-500">Interactive Trainer & Assessor Matrix</p>
            </div>
            <nav class="hidden md:flex md:space-x-8 items-center">
                <a href="#overview" class="font-medium text-stone-600 hover:text-teal-600 transition-colors">Overview</a>
                <a href="#part-a" class="font-medium text-stone-600 hover:text-teal-600 transition-colors">Part A: Profile</a>
                <a href="#part-b" class="font-medium text-stone-600 hover:text-teal-600 transition-colors">Part B: Unit Mapping</a>
                <button id="auth-button" class="ml-4 px-3 py-1.5 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-bca-red hover:bg-opacity-80 disabled:bg-stone-400 disabled:cursor-wait" disabled>Sign in & Authorise</button>
                <div id="user-info" class="ml-4 hidden items-center">
                    <p id="user-name" class="text-sm font-medium text-stone-700"></p>
                    <button id="signout-button" class="ml-2 text-xs text-stone-500 hover:text-red-600">Sign out</button>
                </div>
            </nav>
        </div>
    </div>
</header>

<main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">

    <!-- Section: Overview -->
    <section id="overview" class="mb-12 scroll-mt-20">
        <h2 class="text-3xl font-bold font-spartan tracking-tight text-stone-900 mb-4">Matrix Overview</h2>
        <p class="text-stone-600 max-w-3xl mb-6">This tool helps you complete your Trainer Matrix. Sign in with your Google account to enable saving directly to your Google Drive.</p>
        
        <!-- This section covers the "Why do I need to complete a matrix" component of the instructions.
        This comment is purely here to make it stand out when im scrolling up and down like an ADHD maniac looking for stuff -->
        <div class="space-y-4 max-w-3xl">
            <details class="bg-white p-4 rounded-lg shadow-sm">
                <summary class="flex justify-between items-center cursor-pointer font-medium text-stone-900">
                    Why do I need to complete a Trainer Matrix?
                    <span class="arrow text-bca-gold">▼</span>
                </summary>
                <div class="mt-4 text-stone-600 space-y-2">
                    <p>The Australian Skills Quality Authority (ASQA) requires RTOs to ensure training and assessment are delivered by persons who demonstrate vocational competencies, current industry skills, and current VET knowledge.
                    <p>This matrix is a critical tool for Barrington College Australia to document and verify that our trainers meet these rigorous requirements under the 2025 Standards.</p>
                </div>
            </details>
            
            <!-- This section covers the "How do I complete this interactive matrix?" component of the instructions.
            This comment is purely here to make it stand out when im scrolling up and down like an ADHD maniac looking for stuff -->
            <details class="bg-white p-4 rounded-lg shadow-sm">
                <summary class="flex justify-between items-center cursor-pointer font-medium text-stone-900">
                    How do I complete this interactive matrix?
                    <span class="arrow text-bca-gold">▼</span>
                </summary>
                <div class="mt-4 text-stone-600 space-y-2">
                    <p><strong>1. Review each section:</strong> Navigate using the links in the header.</p>
                    <p><strong>2. Complete your profile in Part A:</strong> Fill in your credentials, experience, and professional development activities.</p>
                    <p><strong>3. Map your units in Part B: </strong>Click the 'Add Unit of Competency' button for each unit you deliver and fill in the required mapping information.</p>
                    <p><strong>4. Finalise and Save: </strong>Once complete, use the "Finalise & Prepare for Approval" button at the bottom of the page to generate a summary you can print to PDF or copy.</p>
                </div>
            </details>
            
            <!-- This section covers the "How do I save to Google Drive?" component of the instructions.
            This comment is purely here to make it stand out when im scrolling up and down like an ADHD maniac looking for stuff -->
            <details class="bg-white p-4 rounded-lg shadow-sm">
                <summary class="flex justify-between items-center cursor-pointer font-medium text-stone-900">
                    How do I save to Google Drive?
                    <span class="arrow text-bca-gold">▼</span>
                </summary>
                <div class="mt-4 text-stone-600 space-y-2">
                    <p>1. Click <strong>"Sign in & Authorise"</strong> in the header and follow the prompts from Google.</p>
                    <p>2. Complete the form below.</p>
                    <p>3. Click <strong>"Finalise & Export"</strong>, and then <strong>"Save to Google Drive"</strong>.
                    <p>The completed PDF will be saved directly to the <strong>"My Drive"</strong> section of your <strong>Google Drive</strong>.</p>
                </div>
            </details>
            <!-- This section covers "Part A: Trainer & Assessor Profile" instructions.
            This comment is purely here to make it stand out when im scrolling up and down like an ADHD maniac looking for stuff -->
            <details class="bg-white p-4 rounded-lg shadow-sm">
                <summary class="flex justify-between items-center cursor-pointer font-medium text-stone-900">
                    How to complete Part A: Trainer & Assessor Profile
                    <span class="arrow text-bca-gold">▼</span>
                </summary>
                <div class="mt-4 text-stone-600 space-y-2">
                    <p>1. Fill in your <strong>First & Last Name</strong> in the "Trainer Name Section".</p>
                    <p>2. Add today's date in the <strong>"Date"</strong> section</p>
                    <p>3. Add your email address in the <strong>"Email Address"</strong>section (can be personal or Barrington College email).</p>
                    <p>4. Add your phone number in the <strong>"Phone Number"</strong> section.</p>
                    <br/>
                    <p><strong>Trainer/Assessor Credentials</strong></p>
                    <p>Select which ever of the credentials you currently hold (You can select multiple if applicable).</p>
                    <br/>
                    <p><strong>Vocational Qualifications & Industry Experience</strong></p>
                    <p><strong>Now you need to add your industry qualifications</strong></p>
                    <p>1. Click the <strong>"+ Add Qualification"</strong> button</p>
                    <p>2. Fill in <strong>Qualification Name</strong> e.g. "BSB50120 Diploma of Business"</p>
                    <p>3. Fill in <strong>Awarding Provider</strong> e.g. "Barrington College Australia"</p>
                    <p>4. Fill in <strong>Date Awarded</strong>e.g. "7th of June 2025"</p>
                    <br/>
                    <p><strong>Next you need to add your Industry Experience</strong></p>
                    <p>1. Fill in <strong>Role / Position</strong>e.g. "Floor Manager"</p>
                    <p>2. Fill in <strong>Employer</strong>e.g. "XYZ Incorporated"</p>
                    <p>3. Fill in <strong>Duration</strong> e.g. "June 2024 - July 2025"</p>
                    <br/>
                    <p><strong>Ongoing Industry Engagement & Currency</strong></p>
                    <p><strong>Next you will need to list your Industry Engagement and Currency</strong></p>
                    <p>1. Fill in <strong>Activity Type</strong>e.g. "Industry Association Membership"</p>
                    <p>2. Fill in <strong>Description</strong>e.g. "Maintained annual membership with the National Welding Institute, including monthly journal subscription."</p>
                    <p>3. Fill in <strong>Date(s)</strong>e.g. "July 2024 - June 2025"</p>
                    <p>4. Fill in <strong>Impact on Practice</strong>e.g. "Gained insight into new automated welding techniques which will be incorporated into the updated delivery plan for MEM05051A."</p>
                    <br/>
                    <p><strong>Next you will need to list your VET Professional Development</strong></p>
                    <p>1. Fill in <strong>Activity Type</strong>e.g. "Webinar"</p>
                    <p>2. Fill in <strong>Description</strong>e.g. "Attended a Velg Training webinar on "Using AI for Effective Assessment"."</p>
                    <p>3. Fill in <strong>Date(s)</strong>e.g. "10 October 2024"</p>
                    <p>4. Fill in <strong>Impact on VET Practice</strong>e.g. "Gained practical strategies for using AI to create diverse assessment questions, improving the efficiency and quality of assessment development."</p>
                    <br/>
                    <p><strong>Finally, you will need to complete the Trainer Reflective Statement section</strong></p>
                    <p>This section is for self-reflection on your own capabilities as a trainer and assessor. It provides a formal opportunity to critically evaluate your skills against industry and VET standards, identifying any gaps or areas for improvement. Ultimately, it helps you create a focused professional development plan to ensure you continuously enhance the quality and relevance of your training and assessment practices.</p><br/>
                    <p><strong>For Example:</strong></p>
                    <p><i>Based on my self-assessment and recent student feedback, I have identified two key areas for future professional development.<br/><br/>
                        <strong>Firstly</strong>, I aim to enhance my skills in creating and facilitating engaging online learning experiences. While proficient in face-to-face delivery, I need to develop greater expertise in using our Learning Management System's (LMS) interactive features, such as forums and collaborative workshops, to increase student engagement in the online components of the course. I plan to address this by enrolling in the organisation's internal "Advanced Moodle Facilitation" workshop scheduled for September.<br/><br/>
                        <strong>Secondly</strong>, I will focus on developing more advanced strategies for supporting students with diverse learning needs, particularly in the area of neurodiversity. To further enhance my practice, I plan to attend a webinar on "Inclusive Classroom Practices for Neurodiverse Learners" and subsequently update my session plans and assessment tools to better reflect universal design for learning (UDL) principles. This will ensure I am providing a more equitable and effective learning environment for all students.</i></p>
                </div>
            </details>
            <!-- This section covers "Part B: Unit of Competency Mapping" instructions.
            This comment is purely here to make it stand out when im scrolling up and down like an ADHD maniac looking for stuff -->
            <details class="bg-white p-4 rounded-lg shadow-sm">
                <summary class="flex justify-between items-center cursor-pointer font-medium text-stone-900">
                    How to complete Part B: Unit of Competency Mapping
                    <span class="arrow text-bca-gold">▼</span>
                </summary>
                <div class="mt-4 text-stone-600 space-y-2">
                    <p>This section is where you will map your personal skills, knowledge, and experience directly to the specific Unit of Competency you wish to teach and assess. This process demonstrates how your qualifications and recent experience meet the requirements of the unit, which is a critical part of regulatory compliance.</p>
                    <br>
                    <p><strong>Adding the Unit of Competency</strong></p>
                    <p>1. First, click the <strong>"+ Add Unit of Competency"</strong> button to create a new mapping table.</p>
                    <p>2. Fill in the <strong>Unit Code</strong>, for example: "BSBCRT511".</p>
                    <p>3. Fill in the <strong>Unit Title</strong>, for example: "Develop critical thinking in others".</p>
                    <br>
                    <p>For each unit you add, you must provide evidence for the following three sections.</p>
                    <br>
                    <p><strong>1. Evidence of Vocational Competency</strong></p>
                    <p>In this section, you need to explain how you have the technical skills and knowledge required by the unit. This is typically demonstrated by holding the unit itself, a superseded equivalent, or a higher-level qualification. You must clearly state what the evidence is and where it can be found.</p>
                    <br>
                    <p><strong>For Example:</strong></p>
                    <p><i>"I hold the BSB50120 Diploma of Business, which includes this unit of competency as a core unit. A certified copy of my qualification and transcript showing this unit is attached."</i></p>
                    <br>
                    <p><strong>2. Confirmation of Current Industry Skills</strong></p>
                    <p>Here, you must demonstrate how your industry skills are current and relevant to this specific unit. You should refer back to the industry engagement activities you listed in Part A and explain how they relate directly to the skills and knowledge within this unit.</p>
                    <br>
                    <p><strong>For Example:</strong></p>
                    <p><i>"My recent role as a Marketing Manager at XYZ Inc. (June 2024 - July 2025) required me to mentor my team to develop critical thinking skills for campaign analysis. My attendance at the 'Future Leaders Conference' in March 2025 also included workshops on innovative problem-solving, which directly relates to the performance evidence of this unit."</i></p>
                    <br>
                    <p><strong>3. Confirmation of Current VET Knowledge & Skills</strong></p>
                    <p>This section is to confirm your currency as a trainer and assessor in the context of this unit. Refer back to your VET Professional Development from Part A and describe how it equips you to teach and assess this particular unit effectively and to standard.</p>
                    <br>
                    <p><strong>For Example:</strong></p>
                    <p><i>"My TAE50122 Diploma of Vocational Education and Training equipped me with skills in designing assessments for cognitive tasks. The webinar I attended on 'Using AI for Effective Assessment' on 10th October 2024 gave me specific techniques to design varied and complex scenarios to validly assess the critical thinking skills required in this unit."</i></p>
                </div>
            </details>
        </div>
    </section>

    <!-- Section: Part A - Trainer and Assessor Profile -->
    <section id="part-a" class="mb-12 scroll-mt-20">
        <h2 class="text-3xl font-bold font-spartan tracking-tight text-stone-900 mb-2">Part A: Trainer & Assessor Profile</h2>
        <div class="bg-white p-6 mt-8 rounded-lg shadow-sm">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <!--  -->
                    <label for="trainerName" class="block text-sm font-medium text-stone-700" >Trainer Name</label>
                    <input type="text" id="trainerName" class="mt-1 block w-full rounded-md border border-stone-300 shadow-lg p-2 focus:border-teal-500 focus:ring-teal-500" data-save>
                </div>
                <div>
                    <label for="trainerDate" class="block text-sm font-medium text-stone-700">Date</label>
                    <input type="date" id="trainerDate" class="mt-1 block w-full rounded-md border border-stone-300 shadow-lg p-2 focus:border-teal-500 focus:ring-teal-500" data-save>
                </div>
                <div>
                    <label for="trainerEmail" class="block text-sm font-medium text-stone-700">Email Address</label>
                    <input type="email" id="trainerEmail" class="mt-1 block w-full rounded-md border border-stone-300 shadow-lg p-2 focus:border-teal-500 focus:ring-teal-500" data-save>
                </div>
                <div>
                    <label for="trainerPhone" class="block text-sm font-medium text-stone-700">Phone Number</label>
                    <input type="tel" id="trainerPhone" class="mt-1 block w-full rounded-md border border-stone-300 shadow-lg p-2 focus:border-teal-500 focus:ring-teal-500" data-save>
                </div>
            </div>
            <hr class="my-8">
            <h3 class="text-xl font-semibold text-stone-800 mb-4">1. Trainer/Assessor Credentials</h3>
            <div id="credentials-container" class="space-y-2">
                <div class="border border-stone-200 rounded-md p-3"><label class="flex items-center space-x-3"><input type="checkbox" name="credential" class="h-4 w-4 text-teal-600 border-stone-300 focus:ring-teal-500" value="TAE40122" data-save><span class="font-medium">TAE40122 Certificate IV in Training and Assessment or its successor.</span></label></div>
                <div class="border border-stone-200 rounded-md p-3"><label class="flex items-center space-x-3"><input type="checkbox" name="credential" class="h-4 w-4 text-teal-600 border-stone-300 focus:ring-teal-500" value="TAE40116" data-save><span class="font-medium">TAE40116 Certificate IV in Training and Assessment.</span></label></div>
                <div class="border border-stone-200 rounded-md p-3"><label class="flex items-center space-x-3"><input type="checkbox" name="credential" class="h-4 w-4 text-teal-600 border-stone-300 focus:ring-teal-500" value="TAE40110" data-save><span class="font-medium">TAE40110 Certificate IV plus required gap units.</span></label></div>
                <div class="border border-stone-200 rounded-md p-3"><label class="flex items-center space-x-3"><input type="checkbox" name="credential" class="h-4 w-4 text-teal-600 border-stone-300 focus:ring-teal-500" value="Diploma" data-save><span class="font-medium">Diploma or higher-level qualification in adult education or VET.</span></label></div>
                <div class="border border-stone-200 rounded-md p-3"><label class="flex items-center space-x-3"><input type="checkbox" name="credential" class="h-4 w-4 text-teal-600 border-stone-300 focus:ring-teal-500" value="Secondary" data-save><span class="font-medium">Secondary teaching qualification plus a required VET skill set.</span></label></div>
            </div>
            <hr class="my-8">
            <h3 class="text-xl font-semibold text-stone-800 mb-4">2. Vocational Qualifications & Industry Experience</h3>
            <div class="overflow-x-auto"><table class="w-full">
                <thead class="bg-stone-50"><tr><th class="p-3 text-left text-sm font-semibold text-stone-600">Qualification Name</th><th class="p-3 text-left text-sm font-semibold text-stone-600">Awarding Provider</th><th class="p-3 text-left text-sm font-semibold text-stone-600">Date Awarded</th><th class="p-3"></th></tr></thead>
                <tbody id="qualifications-body"></tbody></table><button id="add-qualification" class="mt-2 text-sm text-bca-gold hover:text-opacity-80 font-medium">+ Add Qualification</button></div>
            <div class="mt-6 overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-stone-50"><tr><th class="p-3 text-left text-sm font-semibold text-stone-600">Role / Position</th><th class="p-3 text-left text-sm font-semibold text-stone-600">Employer</th><th class="p-3 text-left text-sm font-semibold text-stone-600">Duration</th><th class="p-3"></th></tr></thead>
                    <tbody id="experience-body"></tbody>
                </table>
                <button id="add-experience" class="mt-2 text-sm text-bca-gold hover:text-opacity-80 font-medium">+ Add Industry Experience</button></div>
            <hr class="my-8">
            <h3 class="text-xl font-semibold text-stone-800 mb-4">3. Ongoing Industry Engagement & Currency</h3>
            <div class="overflow-x-auto"><table class="w-full">
                <thead class="bg-stone-50"><tr><th class="p-3 text-left text-sm font-semibold text-stone-600">Activity Type</th><th class="p-3 text-left text-sm font-semibold text-stone-600">Description</th><th class="p-3 text-left text-sm font-semibold text-stone-600">Date(s)</th><th class="p-3 text-left text-sm font-semibold text-stone-600">Impact on Practice</th><th class="p-3"></th></tr></thead>
                <tbody id="engagement-body"></tbody></table><button id="add-engagement" class="mt-2 text-sm text-bca-gold hover:text-opacity-80 font-medium" >+ Add Engagement Activity</button></div>
            <hr class="my-8">
            <h3 class="text-xl font-semibold text-stone-800 mb-4">4. VET Professional Development</h3>
            <div class="overflow-x-auto"><table class="w-full">
                <thead class="bg-stone-50"><tr><th class="p-3 text-left text-sm font-semibold text-stone-600">Activity Type</th><th class="p-3 text-left text-sm font-semibold text-stone-600">Description</th><th class="p-3 text-left text-sm font-semibold text-stone-600">Date(s)</th><th class="p-3 text-left text-sm font-semibold text-stone-600" >Impact on VET Practice</th><th class="p-3"></th></tr></thead>
                <tbody id="vet-pd-body"></tbody></table><button id="add-vet-pd" class="mt-2 text-sm text-bca-gold hover:text-opacity-80 font-medium" >+ Add VET PD Activity</button></div>
            <hr class="my-8">
            <h3 class="text-xl font-semibold text-stone-800 mb-4">5. Trainer Reflective Statement</h3>
            <div>
                <label for="reflective-statement" class="block text-sm font-medium text-stone-700">Based on your self-assessment, identify any areas for your own future professional development to further enhance your training and assessment practice.</label>
                <textarea id="reflective-statement" rows="4" class="mt-1 block w-full rounded-md border border-stone-300 shadow-lg focus:border-teal-500 focus:ring-teal-500" data-save></textarea>
            </div>
        </div>
    </section>

    <!-- Section: Part B -->
    <section id="part-b" class="mb-12 scroll-mt-20">
        <h2 class="text-3xl font-bold font-spartan tracking-tight text-stone-900 mb-2">Part B: Unit of Competency Mapping</h2>
        <div id="unit-mapping-container" class="space-y-6 mt-8"></div>
        <div class="mt-6"><button id="add-unit-button" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-bca-red hover:bg-opacity-80 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500" data-save>+ Add Unit of Competency</button></div>
    </section>
</main>

<!-- Footer Action Bar -->
<footer class="sticky bottom-0 bg-white/90 backdrop-blur-sm z-30">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-3 border-t border-stone-200 flex justify-end items-center space-x-4">
        <p id="save-status" class="text-sm text-gray-500 mr-auto"></p>
        <button id="save-progress-button" class="px-4 py-2 border border-stone-300 text-sm font-medium rounded-md text-stone-700 bg-white hover:bg-stone-50">Save Progress</button>
        <button id="finalise-button" class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-bca-red hover:bg-opacity-80 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-bca-gold">Finalise & Export</button>
    </div>
</footer>

<!-- Modal for Approval -->
<div id="approval-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
    <div id="approval-modal-content" class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col">
        <div class="p-6 border-b">
            <h2 class="text-2xl font-spartan font-bold text-stone-900">Matrix Export</h2>
            <p class="text-sm text-stone-600 mt-1">Review the data below, then choose an export option.</p>
            <p id="export-status" class="text-sm font-semibold mt-2 h-5"></p>
        </div>
        <div id="modal-data-container-wrapper" class="overflow-y-auto p-6 space-y-6">
            <div id="modal-data-container">
                <!-- Data will be injected here for PDF generation -->
            </div>
        </div>
        <div class="p-4 bg-stone-50 border-t flex justify-end space-x-3">
            <button id="save-gdrive-button" class="px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-bca-red hover:bg-opacity-80 disabled:bg-stone-400 disabled:cursor-not-allowed" disabled>Save to Google Drive</button>
            <button id="export-pdf-button" class="px-4 py-2 border border-stone-300 text-sm font-medium rounded-md text-stone-700 bg-white hover:bg-stone-50">Download as PDF</button>
            <button id="close-modal-button" class="px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-stone-600 hover:bg-stone-700">Close</button>
        </div>
    </div>
</div>


<template id="unit-card-template">
    <div class="bg-white p-6 rounded-lg shadow-sm unit-card"  data-save-group>
        <div class="flex justify-between items-start"><input type="text" placeholder=" Unit Code and Name, e.g., BSBXCM401" class="unit-title text-lg font-semibold text-stone-800 w-full focus:focus:border-bca-gold bg-transparent" data-save>
            <button class="text-stone-400 hover:text-red-500 remove-unit-button">&times; Remove</button></div><hr class="my-4">
        <div class="space-y-6">
            <div><h4 class="font-semibold text-stone-800">1. Evidence of Vocational Competency</h4><textarea rows="3" class="voc-comp-evidence mt-1 block w-full rounded-md border border-stone-300 shadow-sm focus:border-teal-500 focus:ring-teal-500" placeholder=" e.g., I hold this unit of competency..." data-save></textarea></div>
            <div><h4 class="font-semibold text-stone-800">2. Confirmation of Current Industry Skills</h4><textarea rows="3" class="ind-skills-evidence mt-1 block w-full rounded-md border border-stone-300 shadow-sm focus:border-teal-500 focus:ring-teal-500" placeholder=" Explain how recent industry engagement keeps you current..." data-save></textarea></div>
            <div><h4 class="font-semibold text-stone-800">3. Confirmation of Current VET Knowledge & Skills</h4><textarea rows="3" class="vet-skills-evidence mt-1 block w-full rounded-md border border-stone-300 shadow-sm focus:border-teal-500 focus:ring-teal-500" placeholder=" Explain how recent VET PD has been applied..." data-save></textarea></div>
        </div>
    </div>
</template>

<template id="table-row-template">
    <tr data-save-group>
        <td class="p-2 border-b border-stone-200"><textarea rows="1" class="block w-full rounded-md border border-gray-900 shadow-lg p-2 focus:border-bca-gold focus:ring-bca-gold"  data-save></textarea></td>
        <td class="p-2 border-b border-stone-200"><textarea rows="1" class="block w-full rounded-md border border-gray-900 shadow-lg p-2 focus:border-bca-gold focus:ring-bca-gold" data-save></textarea></td>
        <td class="p-2 border-b border-stone-200"><textarea rows="1" class="block w-full rounded-md border border-gray-900 shadow-lg p-2 focus:border-bca-gold focus:ring-bca-gold" placeholder="e.g., Jan 2022 - Dec 2023" data-save></textarea></td>
        <td class="p-2 border-b border-stone-200 text-center"><button class="text-stone-400 hover:text-red-500 remove-row-button">&times;</button></td>
    </tr>
</template>

<template id="table-row-template-wide">
    <tr data-save-group>
        <td class="p-2 border-b border-stone-200"><textarea rows="1" class="block w-full rounded-md border border-gray-900 shadow-lg p-2 focus:border-bca-gold focus:ring-bca-gold" data-save></textarea></td>
        <td class="p-2 border-b border-stone-200"><textarea rows="1" class="block w-full rounded-md border border-gray-900 shadow-lg p-2 focus:border-bca-gold focus:ring-bca-gold" data-save></textarea></td>
        <td class="p-2 border-b border-stone-200"><textarea rows="1" class="block w-full rounded-md border border-gray-900 shadow-lg p-2 focus:border-bca-gold focus:ring-bca-gold" placeholder="e.g., Jan 2022 - Dec 2023" data-save></textarea></td>
        <td class="p-2 border-b border-stone-200"><textarea rows="1" class="block w-full rounded-md border border-gray-900 shadow-lg p-2 focus:border-bca-gold focus:ring-bca-gold" data-save></textarea></td>
        <td class="p-2 border-b border-stone-200 text-center"><button class="text-stone-400 hover:text-red-500 remove-row-button">&times;</button></td>
    </tr>
</template>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const saveProgressButton = document.getElementById('save-progress-button');
        const saveStatus = document.getElementById('save-status');

        function getFormState() {
            const state = { staticFields: {}, tables: {}, unitCards: [] };
            document.querySelectorAll('[data-save]:not([data-save-group] [data-save])').forEach(el => {
                const id = el.id || el.name;
                if (el.type === 'radio' || el.type === 'checkbox') {
                    if (!state.staticFields[id]) state.staticFields[id] = [];
                    if(el.checked) state.staticFields[id].push(el.value);
                } else {
                    state.staticFields[id] = el.value;
                }
            });
            document.querySelectorAll('tbody[id]').forEach(tbody => {
                const tableId = tbody.id;
                state.tables[tableId] = [];
                tbody.querySelectorAll('tr[data-save-group]').forEach(row => {
                    const rowData = Array.from(row.querySelectorAll('[data-save]')).map(input => input.value);
                    state.tables[tableId].push(rowData);
                });
            });
            document.querySelectorAll('.unit-card[data-save-group]').forEach(card => {
                const cardData = Array.from(card.querySelectorAll('[data-save]')).map(input => input.value);
                state.unitCards.push(cardData);
            });
            return state;
        }

        function saveStateToBrowser() {
            const state = getFormState();
            localStorage.setItem('trainerMatrixProgress', JSON.stringify(state));
            saveStatus.textContent = 'Progress Saved!';
            setTimeout(() => { saveStatus.textContent = ''; }, 3000);
        }

        function loadState() {
            const savedStateJSON = localStorage.getItem('trainerMatrixProgress');
            if (!savedStateJSON) return;

            const state = JSON.parse(savedStateJSON);

            if (state.staticFields) {
                for (const id in state.staticFields) {
                    const value = state.staticFields[id];
                    if (Array.isArray(value)) {
                        document.querySelectorAll(`[name="${id}"]`).forEach(el => el.checked = false);
                        value.forEach(val => {
                            const el = document.querySelector(`[name="${id}"][value="${val}"]`);
                            if (el) el.checked = true;
                        });
                    } else {
                        const el = document.getElementById(id) || document.querySelector(`[name="${id}"][value="${value}"]`);
                        if(el) {
                            if (el.type === 'radio') el.checked = true;
                            else el.value = value;
                        }
                    }
                }
            }
            if (state.tables) {
                for(const tableId in state.tables) {
                    const tbody = document.getElementById(tableId);
                    if (!tbody) continue;

                    // Determine which template to use based on the table
                    let templateId;
                    if (tableId === 'engagement-body' || tableId === 'vet-pd-body') {
                        templateId = 'table-row-template-wide';
                    } else {
                        templateId = 'table-row-template';
                    }
                    const template = document.getElementById(templateId);
                    if (!template) continue;

                    // Clear existing rows before loading
                    tbody.innerHTML = '';

                    state.tables[tableId].forEach(rowData => {
                        const newRow = template.content.cloneNode(true);
                        newRow.querySelectorAll('[data-save]').forEach((input, index) => {
                            if(rowData[index] !== undefined) {
                                input.value = rowData[index];
                            }
                        });
                        tbody.appendChild(newRow);
                    });
                }
            }
            if (state.unitCards) {
                const unitContainer = document.getElementById('unit-mapping-container');
                const cardTemplate = document.getElementById('unit-card-template');
                state.unitCards.forEach(cardData => {
                    const newCard = cardTemplate.content.cloneNode(true);
                    newCard.querySelectorAll('[data-save]').forEach((input, index) => {
                        input.value = cardData[index] || '';
                    });
                    unitContainer.appendChild(newCard);
                });
            }
        }

        saveProgressButton.addEventListener('click', saveStateToBrowser);

        loadState(); // Auto-load from browser on page start
        const { jsPDF } = window.jspdf;

        // --- Google API Integration ---
        const CLIENT_ID = '1013480343553-sh7eaheasf0mduah27se3mqa26fhqfe7.apps.googleusercontent.com';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        let tokenClient;
        let accessToken = null;

        const authButton = document.getElementById('auth-button');
        const signoutButton = document.getElementById('signout-button');
        const userInfoDiv = document.getElementById('user-info');
        const userNameEl = document.getElementById('user-name');
        const gdriveButton = document.getElementById('save-gdrive-button');

        function gisLoaded() {
            try {
                tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: CLIENT_ID,
                    scope: SCOPES,
                    callback: (tokenResponse) => {
                        accessToken = tokenResponse.access_token;
                        handleAuthSuccess();
                    },
                });
                authButton.disabled = false;
                authButton.classList.remove('disabled:cursor-wait');
            } catch(e) {
                console.error("Error initialising GIS client:", e);
                authButton.innerText = "Config Error";
                authButton.title = "Could not initialize Google Sign-In. Check Client ID.";
                authButton.classList.remove('bg-teal-600', 'hover:bg-teal-700');
                authButton.classList.add('bg-red-500');
            }
        }

        window.onload = gisLoaded;

        async function handleAuthSuccess() {
            authButton.classList.add('hidden');
            userInfoDiv.classList.remove('hidden');
            userInfoDiv.classList.add('flex');
            gdriveButton.disabled = false;

            try {
                const response = await fetch('https://www.googleapis.com/oauth2/v3/userinfo', {
                    headers: { 'Authorization': `Bearer ${accessToken}` }
                });
                const userInfo = await response.json();
                userNameEl.textContent = userInfo.name || 'Authorized';
            } catch (err) {
                console.error("Error fetching user name: ", err);
                userNameEl.textContent = "Authorized";
            }
        }

        authButton.onclick = () => {
            tokenClient.requestAccessToken({prompt: 'consent'});
        };

        signoutButton.onclick = () => {
            if (accessToken) {
                google.accounts.oauth2.revoke(accessToken, () => {
                    accessToken = null;
                    authButton.classList.remove('hidden');
                    userInfoDiv.classList.add('hidden');
                    gdriveButton.disabled = true;
                    userNameEl.textContent = '';
                });
            }
        };
        // --- End Google API ---


        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });
            });
        });

        const addUnitButton = document.getElementById('add-unit-button');
        const unitMappingContainer = document.getElementById('unit-mapping-container');
        const unitCardTemplate = document.getElementById('unit-card-template');

        addUnitButton.addEventListener('click', () => {
            unitMappingContainer.appendChild(unitCardTemplate.content.cloneNode(true));
        });

        unitMappingContainer.addEventListener('click', e => {
            if(e.target.classList.contains('remove-unit-button')) e.target.closest('.unit-card').remove();
        });

        function setupDynamicTable(buttonId, tableBodyId, templateId) {
            const addButton = document.getElementById(buttonId);
            const tableBody = document.getElementById(tableBodyId);
            const template = document.getElementById(templateId);

            addButton.addEventListener('click', () => tableBody.appendChild(template.content.cloneNode(true)));
            tableBody.addEventListener('click', e => {
                if (e.target.classList.contains('remove-row-button')) e.target.closest('tr').remove();
            });
        }

        setupDynamicTable('add-qualification', 'qualifications-body', 'table-row-template');
        setupDynamicTable('add-experience', 'experience-body', 'table-row-template');
        setupDynamicTable('add-engagement', 'engagement-body', 'table-row-template-wide');
        setupDynamicTable('add-vet-pd', 'vet-pd-body', 'table-row-template-wide');

        const finaliseButton = document.getElementById('finalise-button');
        const modal = document.getElementById('approval-modal');
        const closeModalButton = document.getElementById('close-modal-button');
        const exportPdfButton = document.getElementById('export-pdf-button');
        const modalDataContainer = document.getElementById('modal-data-container');
        const exportStatus = document.getElementById('export-status');

        function buildReportHtml() {
            let report = `<style> body {font-family: sans-serif;} h3 { font-size: 1.5rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; border-bottom: 1px solid #e5e7eb; padding-bottom: 0.5rem; } h4 { font-size: 1.25rem; font-weight: 600; margin-top: 1rem; margin-bottom: 0.25rem;} p { margin-bottom: 0.5rem; } ul { list-style-position: inside; padding-left: 1rem; margin-bottom: 0.5rem;} hr { margin-top: 1.5rem; margin-bottom: 1.5rem; } .unit-summary { border: 1px solid #f3f4f6; padding: 1rem; margin-bottom: 1rem; border-radius: 0.5rem; background: #fafafa;} </style>`;
            report += '<h3>Part A: Trainer & Assessor Profile</h3>';
            report += `<p><strong>Trainer Name:</strong> ${document.getElementById('trainerName').value || 'N/A'}</p>`;
            report += `<p><strong>Date:</strong> ${document.getElementById('trainerDate').value || 'N/A'}</p>`;

            const selectedCredential = document.querySelector('input[name="credential"]:checked');
            report += '<h4>1. Trainer/Assessor Credentials</h4>';
            report += `<p>${selectedCredential ? selectedCredential.parentElement.textContent.trim() : 'No credential selected'}</p>`;

            report += '<h4>2. Vocational Qualifications</h4>';
            const qualifications = document.querySelectorAll('#qualifications-body tr');
            if(qualifications.length > 0) {
                report += '<ul>';
                qualifications.forEach(row => {
                    const inputs = row.querySelectorAll('textarea');
                    report += `<li>${inputs[0].value || 'N/A'} - ${inputs[1].value || 'N/A'} (${inputs[2].value || 'N/A'})</li>`;
                });
                report += '</ul>';
            } else { report += '<p>None listed.</p>'; }

            report += '<h4>Industry Experience</h4>';
            const experiences = document.querySelectorAll('#experience-body tr');
            if(experiences.length > 0) {
                report += '<ul>';
                experiences.forEach(row => {
                    const inputs = row.querySelectorAll('textarea');
                    report += `<li>${inputs[0].value || 'N/A'} at ${inputs[1].value || 'N/A'} (${inputs[2].value || 'N/A'})</li>`;
                });
                report += '</ul>';
            } else { report += '<p>None listed.</p>'; }

            report += '<h4>3. Ongoing Industry Engagement & Currency</h4>';
            const engagements = document.querySelectorAll('#engagement-body tr');
            if(engagements.length > 0) {
                report += '<ul>';
                engagements.forEach(row => {
                    const inputs = row.querySelectorAll('textarea');
                    report += `<li><strong>${inputs[0].value || 'N/A'}:</strong> ${inputs[1].value || 'N/A'} (${inputs[2].value || 'N/A'}). <strong>Impact:</strong> ${inputs[3].value || 'N/A'}</li>`;
                });
                report += '</ul>';
            } else { report += '<p>None listed.</p>'; }

            report += '<h4>4. VET Professional Development</h4>';
            const vetPds = document.querySelectorAll('#vet-pd-body tr');
            if(vetPds.length > 0) {
                report += '<ul>';
                vetPds.forEach(row => {
                    const inputs = row.querySelectorAll('textarea');
                    report += `<li><strong>${inputs[0].value || 'N/A'}:</strong> ${inputs[1].value || 'N/A'} (${inputs[2].value || 'N/A'}). <strong>Impact:</strong> ${inputs[3].value || 'N/A'}</li>`;
                });
                report += '</ul>';
            } else { report += '<p>None listed.</p>'; }

            report += '<h4>5. Trainer Reflective Statement</h4>';
            report += `<p>${document.getElementById('reflective-statement').value.replace(/\n/g, '<br>') || 'None provided.'}</p>`;

            report += '<hr />';
            report += '<h3>Part B: Unit of Competency Mapping</h3>';
            const unitCards = document.querySelectorAll('.unit-card');
            if (unitCards.length > 0) {
                unitCards.forEach(card => {
                    const title = card.querySelector('.unit-title').value;
                    const vocComp = card.querySelector('.voc-comp-evidence').value.replace(/\n/g, '<br>');
                    const indSkills = card.querySelector('.ind-skills-evidence').value.replace(/\n/g, '<br>');
                    const vetSkills = card.querySelector('.vet-skills-evidence').value.replace(/\n/g, '<br>');
                    report += `<div class="unit-summary"><h4>${title || 'Untitled Unit'}</h4>`;
                    report += `<p><strong>Vocational Competency:</strong><br>${vocComp || 'N/A'}</p>`;
                    report += `<p><strong>Current Industry Skills:</strong><br>${indSkills || 'N/A'}</p>`;
                    report += `<p><strong>Current VET Skills:</strong><br>${vetSkills || 'N/A'}</p></div>`;
                });
            } else {
                report += '<p>No units mapped.</p>';
            }

            return report;
        }

        finaliseButton.addEventListener('click', () => {
            modalDataContainer.innerHTML = buildReportHtml();
            exportStatus.textContent = '';
            modal.classList.remove('hidden');
        });

        function generatePdfBlob(callback) {
            const element = modalDataContainer;
            html2canvas(element, { scale: 2, useCORS: true }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');

                // Define Margin in mm
                const margin = 15;
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();

                // Calculate the usable width
                const usableWidth = pdfWidth - (margin * 2);

                const imgWidth = canvas.width;
                const imgHeight = canvas.height;
                const ratio = imgWidth / imgHeight;

                // Calculate image height based on usable width
                let imgHeightOnPage = usableWidth / ratio;

                let position = 0;

                // Update the addImage() call
                // This sets the left and top margins for the first page
                pdf.addImage(imgData, 'PNG', margin, margin, usableWidth, imgHeightOnPage);

                let heightLeft = imgHeightOnPage - (pageHeight - margin);

                while (heightLeft > 0) {
                    position -= pageHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG',margin, position + margin, usableWidth, imgHeightOnPage);
                    heightLeft -= pageHeight;
                }
                callback(pdf.output('blob'));
            });
        }

        exportPdfButton.addEventListener('click', () => {
            const trainerName = document.getElementById('trainerName').value || 'trainer';
            const fileName = `Trainer-Matrix-${trainerName.replace(/ /g, '_')}.pdf`;
            generatePdfBlob(blob => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            });
        });

        gdriveButton.addEventListener('click', () => {
            exportStatus.textContent = 'Generating PDF...';
            generatePdfBlob(blob => {
                exportStatus.textContent = 'Uploading to Google Drive...';
                const trainerName = document.getElementById('trainerName').value || 'trainer';
                const fileName = `Trainer-Matrix-${trainerName.replace(/ /g, '_')}.pdf`;

                const metadata = {
                    name: fileName,
                    mimeType: 'application/pdf',
                };

                const form = new FormData();
                form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                form.append('file', blob);

                fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                    method: 'POST',
                    headers: new Headers({ 'Authorization': 'Bearer ' + accessToken }),
                    body: form,
                }).then(res => {
                    return res.json();
                }).then(function(val) {
                    if (val.error) {
                        console.error('Upload Error:', val.error);
                        exportStatus.textContent = `Error: ${val.error.message}`;
                        return;
                    }
                    const fileId = val.id;
                    exportStatus.innerHTML = `Success! File saved. <a href="https://drive.google.com/file/d/${fileId}/view" target="_blank" class="text-blue-600 hover:underline">View File</a>`;
                }).catch(error => {
                    exportStatus.textContent = 'Error uploading file. Please try again.';
                    console.error('Upload Error:', error);
                });
            });
        });

        closeModalButton.addEventListener('click', () => modal.classList.add('hidden'));

    });
</script>
</body>
</html>
